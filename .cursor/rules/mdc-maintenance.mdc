---
description: MDC 规则维护指南 - 重大变更时更新规则文件
alwaysApply: true
---

# MDC 规则维护指南

本文档指导 AI agent 在项目发生重大变更时，主动建议用户创建或更新 `.cursor/rules/*.mdc` 规则文件。

## 什么是重大变更

以下情况被视为重大变更，需要评估是否需要更新 mdc 规则：

### 1. 架构变更
- 新增核心模块或子系统（如 `ConfigModule`、`HealthModule`）
- 重构现有模块的架构（如 `auth` 模块重构为 `security` 模块）
- 改变模块间的依赖关系
- 引入新的设计模式或架构模式

### 2. 功能变更
- 新增官方模块（Module）
- 新增装饰器（Decorator）
- 新增中间件（Middleware）
- 新增扩展（Extension）
- 新增核心服务（Service）

### 3. 规范变更
- 修改代码风格规范
- 修改命名约定
- 修改测试规范
- 修改提交信息规范
- 修改文档规范

### 4. 工作流变更
- 新增开发工具或流程
- 修改构建或部署流程
- 新增 CI/CD 步骤
- 修改依赖管理方式

## 何时建议更新 mdc 规则

### 必须建议更新的情况

1. **新增官方模块**
   - 需要在 `architecture-overview.mdc` 中添加模块说明
   - 需要在 `code-style.mdc` 中更新模块结构示例
   - 需要在 `git-commit-guidelines.mdc` 中添加 scope 示例

2. **修改核心架构**
   - 需要在 `architecture-overview.mdc` 中更新架构说明
   - 需要更新模块依赖关系图

3. **修改代码规范**
   - 需要在 `code-style.mdc` 中更新相关规范
   - 需要更新代码审查清单

4. **修改测试规范**
   - 需要在 `testing-guidelines.mdc` 中更新测试要求
   - 需要添加新的测试模式示例

5. **修改提交规范**
   - 需要在 `git-commit-guidelines.mdc` 中更新规范说明

### 建议创建新 mdc 文件的情况

1. **新增重要概念或模式**
   - 如果引入新的重要概念（如新的认证方式、新的中间件模式），考虑创建专门的 mdc 文件

2. **新增开发工具或流程**
   - 如果引入新的开发工具或流程（如性能分析、调试工具），考虑创建专门的 mdc 文件

3. **新增最佳实践**
   - 如果积累了大量关于某个主题的最佳实践，考虑创建专门的 mdc 文件

## 建议格式

当检测到重大变更时，AI agent 应该：

1. **识别变更类型**
   ```
   检测到重大变更：[变更类型]
   - [具体变更内容]
   ```

2. **评估影响范围**
   ```
   此变更可能影响以下 mdc 规则文件：
   - [文件名]：需要更新 [具体内容]
   - [文件名]：需要更新 [具体内容]
   ```

3. **提供建议**
   ```
   建议：
   1. 更新 [文件名]：添加/修改 [具体内容]
   2. 更新 [文件名]：添加/修改 [具体内容]
   3. [可选] 考虑创建新的 mdc 文件：[文件名] 用于 [目的]
   ```

## 现有 mdc 文件及其职责

### `architecture-overview.mdc`
- **职责**：项目架构概览、模块组织、常见模式
- **需要更新时机**：
  - 新增模块时
  - 修改模块结构时
  - 修改模块依赖关系时
  - 新增设计模式时

### `code-style.mdc`
- **职责**：代码风格、命名规范、类型定义、文件组织
- **需要更新时机**：
  - 修改代码风格时
  - 新增命名约定时
  - 修改文件组织方式时
  - 新增模块结构时

### `git-commit-guidelines.mdc`
- **职责**：Git 提交信息规范
- **需要更新时机**：
  - 修改提交信息格式时
  - 新增 scope 类型时
  - 修改提交流程时

### `testing-guidelines.mdc`
- **职责**：测试规范、测试最佳实践
- **需要更新时机**：
  - 修改测试框架时
  - 新增测试模式时
  - 修改测试覆盖要求时

### `mdc-maintenance.mdc`（本文件）
- **职责**：指导 AI agent 维护 mdc 规则文件
- **需要更新时机**：
  - 新增 mdc 文件类型时
  - 修改维护流程时

## 检查清单

在完成重大变更后，AI agent 应该检查：

- [ ] 是否新增了模块？→ 更新 `architecture-overview.mdc`
- [ ] 是否修改了代码规范？→ 更新 `code-style.mdc`
- [ ] 是否新增了 scope 类型？→ 更新 `git-commit-guidelines.mdc`
- [ ] 是否修改了测试规范？→ 更新 `testing-guidelines.mdc`
- [ ] 是否需要创建新的 mdc 文件？→ 评估并建议

## 示例场景

### 场景 1：新增 ConfigModule

**变更**：新增 `ConfigModule` 官方模块

**建议**：
```
检测到重大变更：新增官方模块
- ConfigModule：配置管理模块

此变更可能影响以下 mdc 规则文件：
- architecture-overview.mdc：需要添加 ConfigModule 说明和示例
- code-style.mdc：需要更新模块结构示例
- git-commit-guidelines.mdc：需要添加 config scope 示例

建议：
1. 更新 architecture-overview.mdc：在"官方模块"部分添加 ConfigModule 说明
2. 更新 code-style.mdc：在"模块结构"部分添加 config/ 模块示例
3. 更新 git-commit-guidelines.mdc：在 scope 示例中添加 config
```

### 场景 2：重构 auth 模块为 security 模块

**变更**：将 `auth` 模块重构为 `security` 模块，引入 Spring Security 风格的架构

**建议**：
```
检测到重大变更：架构重构
- auth 模块重构为 security 模块
- 引入 AuthenticationManager、AuthenticationProvider 等新概念

此变更可能影响以下 mdc 规则文件：
- architecture-overview.mdc：需要更新模块说明和架构模式
- code-style.mdc：需要更新模块结构示例

建议：
1. 更新 architecture-overview.mdc：更新 security 模块说明，添加新的架构模式
2. 更新 code-style.mdc：更新模块结构示例，将 auth/ 改为 security/
```

### 场景 3：新增测试规范

**变更**：新增测试规范文档

**建议**：
```
检测到重大变更：新增规范文档
- 新增 testing-guidelines.mdc：测试规范和最佳实践

此变更可能影响以下 mdc 规则文件：
- mdc-maintenance.mdc：需要在"现有 mdc 文件及其职责"部分添加新文件说明

建议：
1. 更新 mdc-maintenance.mdc：添加 testing-guidelines.mdc 的职责说明
```

## 注意事项

1. **不要过度建议**：只有真正的重大变更才需要更新 mdc 规则
2. **保持一致性**：确保所有 mdc 文件中的信息保持一致
3. **及时更新**：在完成变更后立即建议更新，不要等到最后
4. **用户决定**：最终是否更新由用户决定，AI agent 只负责建议

## 参考

- [Cursor Rules 文档](https://docs.cursor.com/context/rules)
- 项目现有 mdc 文件：`.cursor/rules/*.mdc`
